"use strict";(self.webpackChunkghc_login_app=self.webpackChunkghc_login_app||[]).push([[552],{2756:(e,n,t)=>{t.d(n,{A:()=>a});var o=t(6314),i=t.n(o)()(function(e){return e[1]});i.push([e.id,"/* Page container that holds both the image and the annotation stage */\n.annotablePage-module__pageContainer___lilH1 {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n\n/* Background image that fills the page */\n.annotablePage-module__pageImage___o7kZB {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  object-position: center;\n  z-index: 1;\n  pointer-events: none; /* Allow clicks to pass through to the stage */\n}\n\n/* Konva stage overlay */\n.annotablePage-module__stage___3i5Bm {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 2;\n  cursor: crosshair;\n}\n\n/* Comment bubble */\n\n/* little triangular arrow pointing to the rect */\n.annotablePage-module__commentArrow___A4LZQ {\n  position: absolute;\n  top: 12px;\n  left: -8px;\n  width: 0;\n  height: 0;\n  border-top: 8px solid transparent;\n  border-bottom: 8px solid transparent;\n  border-right: 8px solid #ffffff;\n  filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.06));\n}\n\n/* header */\n.annotablePage-module__commentHeader___S\\+b0\\+ {\n  font-weight: 600;\n  font-size: 13px;\n  color: #555;\n}\n\n/* text shown when not editing */\n.annotablePage-module__commentText___Lwe6k {\n  cursor: pointer;\n  padding: 6px 4px;\n  border-radius: 6px;\n  transition: background 0.15s ease;\n  white-space: pre-wrap;\n  line-height: 1.4;\n  min-height: 34px;\n}\n\n.annotablePage-module__commentText___Lwe6k:hover {\n  background-color: #fafafa;\n}\n\n/* placeholder text inside the comment area */\n.annotablePage-module__placeholder___s-2Xt {\n  color: #aaa;\n  font-style: italic;\n}\n\n/* textarea when editing */\n\n/* focus ring for accessibility */\n.annotablePage-module__commentTextarea___vYCJb:focus {\n  box-shadow: 0 0 0 3px rgba(0,120,215,0.08);\n  border-color: rgba(0,120,215,0.4);\n}\n\n.annotablePage-module__addCommentButton___fY8Sm {\n  align-self: center;\n  margin-top: 8px;\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  border: none;\n  background: #0078d7;\n  color: white;\n  font-size: 20px;\n  font-weight: bold;\n  cursor: pointer;\n  box-shadow: 0 4px 10px rgba(0,0,0,0.15);\n  transition: background 0.2s ease;\n}\n\n.annotablePage-module__addCommentButton___fY8Sm:hover {\n  background: #005a9e;\n}\n\n.annotablePage-module__commentRow___rnzKw {\n  display: flex;\n  align-items: flex-start;\n  gap: 6px;\n  margin-bottom: 6px;\n}\n\n.annotablePage-module__deleteButton___NKFp4 {\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  font-size: 16px;\n  line-height: 1;\n  padding: 2px 4px;\n  color: #888;\n  transition: color 0.2s ease;\n}\n\n.annotablePage-module__deleteButton___NKFp4:hover {\n  color: #d11a2a;\n}\n\n.annotablePage-module__pendingInfo___3d7Gr {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n  padding: 4px;\n  background-color: #f5f5f5;\n  border-radius: 4px;\n}\n\n.annotablePage-module__commentBubble___F3JGc {\n  position: fixed;\n  max-width: 90%;       /* adapt to screen width */\n  width: auto;          /* shrink on smaller devices */\n  min-width: 200px;     /* don't get too small */\n  padding: 10px 14px;\n  border-radius: 10px;\n  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.18);\n  font-size: 14px;\n  z-index: 2000;\n  pointer-events: none;\n  user-select: none;\n  background-color: white;\n  animation: annotablePage-module__fadeIn___I-0e5 0.18s ease-out;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  pointer-events: auto;\n  word-break: break-word;\n}\n\n.annotablePage-module__commentTextarea___vYCJb {\n  width: 100%;\n  min-height: 60px;\n  font-size: 14px;\n  resize: vertical;\n}\n\n@media (max-width: 480px) {\n  .annotablePage-module__commentBubble___F3JGc {\n    font-size: 13px;\n    padding: 8px 10px;\n    max-width: 90vw;\n  }\n  .annotablePage-module__commentTextarea___vYCJb {\n    min-height: 50px;\n    font-size: 13px;\n  }\n}\n\n\n/* subtle fade-in animation */\n@keyframes annotablePage-module__fadeIn___I-0e5 {\n  from {\n    opacity: 0;\n    transform: translateY(-6px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}",""]),i.locals={pageContainer:"annotablePage-module__pageContainer___lilH1",pageImage:"annotablePage-module__pageImage___o7kZB",stage:"annotablePage-module__stage___3i5Bm",commentArrow:"annotablePage-module__commentArrow___A4LZQ",commentHeader:"annotablePage-module__commentHeader___S+b0+",commentText:"annotablePage-module__commentText___Lwe6k",placeholder:"annotablePage-module__placeholder___s-2Xt",commentTextarea:"annotablePage-module__commentTextarea___vYCJb",addCommentButton:"annotablePage-module__addCommentButton___fY8Sm",commentRow:"annotablePage-module__commentRow___rnzKw",deleteButton:"annotablePage-module__deleteButton___NKFp4",pendingInfo:"annotablePage-module__pendingInfo___3d7Gr",commentBubble:"annotablePage-module__commentBubble___F3JGc",fadeIn:"annotablePage-module__fadeIn___I-0e5"};const a=i},4552:(e,n,t)=>{t.r(n),t.d(n,{default:()=>k});var o=t(6540),i=t.n(o),a=t(467),r=t(5458),l=t(4467),u=t(296),s=t(4756),d=t.n(s),c=t(961),h=t(5391),g=t(5072),p=t.n(g),m=t(2756);p()(m.A,{insert:"head",singleton:!1});const f=m.A.locals||{};var _=t(5504);function v(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?v(Object(t),!0).forEach(function(n){(0,l.A)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}const w=function(e){var n=e.pageImage,t=e.pageNumber,l=e.pdfId,s=e.isDrawing,g=e.isFreehand,p=e.highlightColor,m=e.setIsCommentOpen,v=e.brushSize,w=e.stageWidth,x=void 0===w?500:w,y=e.stageHeight,k=void 0===y?700:y,P=e.freehandOpensComment,A=void 0===P||P,C=e.serverAnnotations,E=void 0===C?[]:C,I=e.onAnnotationsChange,S=e.eraserMode,z=void 0!==S&&S,D=e.onDeleteAnnotation,O=e.onUpdateHighlightComment,B=(0,o.useState)([]),W=(0,u.A)(B,2),N=W[0],M=W[1],T=(0,o.useState)([]),L=(0,u.A)(T,2),H=L[0],j=L[1],F=(0,o.useState)(null),J=(0,u.A)(F,2),R=J[0],Y=J[1],K=(0,o.useState)(null),G=(0,u.A)(K,2),U=G[0],Z=G[1],Q=(0,o.useState)(null),X=(0,u.A)(Q,2),V=X[0],q=X[1],$=(0,o.useState)(null),ee=(0,u.A)($,2),ne=ee[0],te=ee[1],oe=(0,o.useState)(!1),ie=(0,u.A)(oe,2),ae=ie[0],re=ie[1],le=(0,o.useState)(""),ue=(0,u.A)(le,2),se=ue[0],de=ue[1],ce=(0,o.useState)({width:x,height:k}),he=(0,u.A)(ce,2),ge=he[0],pe=he[1],me=(0,o.useState)(null),fe=(0,u.A)(me,2),_e=fe[0],ve=fe[1],be=(0,o.useRef)(null),we=(0,o.useRef)(null),xe=(0,o.useRef)(null),ye=(0,o.useState)({top:0,left:0,visible:!1}),ke=(0,u.A)(ye,2),Pe=ke[0],Ae=ke[1],Ce=function(e,n,t){return b(b({},e),{},{x:e.x*n,y:e.y*t,width:e.width*n,height:e.height*t})},Ee=function(e,n,t){return b(b({},e),{},{points:e.points.map(function(e,o){return o%2==0?e*n:e*t})})};(0,o.useEffect)(function(){if(E&&E[l]&&E[l][t]){var e=E[l][t];console.log("Server items for pdf ".concat(l," page ").concat(t,":"),e);var n=e.map(function(e){var n,t,o,i;return e&&"group"===e.type?b(b({},e),{},{highlights:(e.highlights||[]).map(function(e){var n,t;return b(b({},e),{},{strokeWidth:null!==(n=null!==(t=e.stroke_width)&&void 0!==t?t:e.strokeWidth)&&void 0!==n?n:2})}),comments:(e.comments||[]).map(function(e){var n,t,o,i;return{text:null!==(n=e.text)&&void 0!==n?n:"",createdAt:null!==(t=null!==(o=e.createdAt)&&void 0!==o?o:e.created_at)&&void 0!==t?t:Date.now(),id:null!==(i=e.id)&&void 0!==i?i:void 0}})}):e&&Array.isArray(e.comments)&&("freehand"===e.type||"rect"===e.type)?b(b({},e),{},{strokeWidth:null!==(o=null!==(i=e.stroke_width)&&void 0!==i?i:e.strokeWidth)&&void 0!==o?o:2,comments:e.comments.map(function(e){var n,t,o;return{text:null!==(n=e.text)&&void 0!==n?n:"",createdAt:null!==(t=null!==(o=e.createdAt)&&void 0!==o?o:e.created_at)&&void 0!==t?t:Date.now()}})}):b(b({},e),{},{strokeWidth:null!==(n=null!==(t=null==e?void 0:e.stroke_width)&&void 0!==t?t:null==e?void 0:e.strokeWidth)&&void 0!==n?n:2})});M(function(e){return n})}},[E,l,t]),(0,o.useEffect)(function(){"function"==typeof I&&I(t,N,H)},[t,N,H,I]),(0,o.useEffect)(function(){if(n){var e=new window.Image;e.crossOrigin="anonymous",e.src=n,e.onload=function(){ve(e)},e.onerror=function(){return ve(null)}}else ve(null)},[n]);var Ie=(0,o.useCallback)(function(){var e=be.current;if(e&&_e){var n=e.clientWidth||x,t=e.clientHeight||window.innerHeight,o=_e.naturalWidth/_e.naturalHeight,i=n,a=i/o;a>t&&(i=(a=t)*o),pe({width:Math.round(i),height:Math.round(a)})}},[_e,x,k]);(0,o.useEffect)(function(){if(Ie(),be.current){var e=new ResizeObserver(function(){return Ie()});return e.observe(be.current),window.addEventListener("resize",Ie),function(){e.disconnect(),window.removeEventListener("resize",Ie)}}},[Ie]);var Se=(0,o.useCallback)(function(){var e=we.current;if(!e)return Ae({top:0,left:0,visible:!1});var n,t,o=e.container().getBoundingClientRect(),i=ge.width,a=ge.height,r=null;if(null!=V&&N[V]){var l,u=N[V];r="group"===u.type&&null!==(l=u.highlights)&&void 0!==l&&l.length?u.highlights[u.highlights.length-1]:u}else null!=ne&&H[ne]&&(r=H[ne]);if(!r)return Ae({top:0,left:0,visible:!1});if("freehand"===r.type){var s=Ee(r,i,a).points,d=s[s.length-2],c=s[s.length-1];n=o.top+c,t=o.left+d+12}else{var h=Ce(r,i,a);n=o.top+h.y,t=o.left+(h.x+h.width)+12}var g=window.innerWidth,p=window.innerHeight;t=Math.min(Math.max(8,t),g-320-8),n=Math.min(Math.max(8,n),p-150-8),Ae({top:n,left:t,visible:!0})},[V,ne,N,H,ge]);(0,o.useEffect)(function(){return Se(),window.addEventListener("resize",Se),window.addEventListener("scroll",Se,!0),function(){window.removeEventListener("resize",Se),window.removeEventListener("scroll",Se,!0)}},[Se]);var ze=function(){null!=V&&ae&&Ne()};(0,o.useEffect)(function(){var e=function(e){xe.current&&xe.current.contains(e.target)||(ze(),q(null),te(null),re(!1),m(!1))};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),function(){document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[m,V,ae]);var De=function(e){if(s){var n=e.target.getStage();if(n){var t=e.target.getClassName?e.target.getClassName():null;if(e.target===n||"Image"===t){var o=n.getPointerPosition();o&&(g?Z({points:[o.x,o.y],type:"freehand",color:p,strokeWidth:v}):Y({x:o.x,y:o.y,width:0,height:0,type:"rect"}),q(null),te(null),re(!1),m(!1))}}}},Oe=function(e){if(s){var n=we.current||e.target&&e.target.getStage&&e.target.getStage();if(n){var t=n.getPointerPosition();t&&(g&&U?Z(function(e){return b(b({},e),{},{points:[].concat((0,r.A)(e.points),[t.x,t.y])})}):!g&&R&&Y(function(e){return b(b({},e),{},{width:t.x-e.x,height:t.y-e.y})}))}}},Be=function(){if(s){var e=we.current;if(e){var n=e.width(),t=e.height();if(g&&U){var o=function(e,n,t){return b(b({},e),{},{points:e.points.map(function(e,o){return o%2==0?e/n:e/t})})}(U,n,t);A?j(function(e){var n=[].concat((0,r.A)(e),[o]),t=n.length-1;return te(t),re(!0),m(!0),n}):M(function(e){return[].concat((0,r.A)(e),[o])}),Z(null)}else if(!g&&R){if(Math.abs(R.width)>5&&Math.abs(R.height)>5){var i=R.x,a=R.y,l=R.width,u=R.height;l<0&&(i+=l,l=Math.abs(l)),u<0&&(a+=u,u=Math.abs(u));var d=function(e,n,t){return b(b({},e),{},{x:e.x/n,y:e.y/t,width:e.width/n,height:e.height/t})}({x:i,y:a,width:l,height:u,type:"rect"},n,t);j(function(e){var n=[].concat((0,r.A)(e),[d]),t=n.length-1;return te(t),re(!0),n})}Y(null)}}}},We=function(e,n){var t,o,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.cancelBubble=!0,ze(),i?(te(e),q(null),de((null===(t=H[e])||void 0===t||null===(t=t.comments)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.text)||"")):(q(e),te(null),de((null===(o=N[e])||void 0===o||null===(o=o.comments)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.text)||"")),re(!0),m(!0)},Ne=function(){if(null!=V&&N[V]){var e,n,t=N[V],o="group"===t.type&&null!==(e=t.highlights)&&void 0!==e&&e.length?t.highlights[t.highlights.length-1]:t,i=(null==o?void 0:o.annotationId)||(null==t?void 0:t.annotationId),a=null==o?void 0:o.id,r=t.comments&&(null===(n=t.comments[0])||void 0===n?void 0:n.text)||se||"";i&&a&&"function"==typeof O&&O(i,a,r)}},Me=function(){var e=(0,a.A)(d().mark(function e(n){var t,o=arguments;return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>1&&void 0!==o[1]?o[1]:null,!(o.length>2&&void 0!==o[2]&&o[2])){e.next=1;break}return j(function(e){return e.filter(function(e,t){return t!==n})}),ne===n&&te(null),e.abrupt("return");case 1:M(function(e){var o=JSON.parse(JSON.stringify(e||[])),i=o[n];if(!i)return e;var a=null;if("group"===i.type&&"number"==typeof t){var r=i.highlights[t];a=null==r?void 0:r.id,i.highlights.splice(t,1),i.comments&&i.comments.length>0&&(i.comments=[]),i.highlights&&0!==i.highlights.length||o.splice(n,1)}else i.type,a=i.id,o.splice(n,1);return V===n&&q(null),a&&D&&D(a).catch(function(e){console.error("Failed to delete from server:",e)}),o});case 2:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}(),Te=function(e,n,t){return"freehand"===e.type?i().createElement(h.N1,{key:n,points:e.points,stroke:e.color||p,strokeWidth:e.strokeWidth||v,tension:.5,lineCap:"round",lineJoin:"round",onClick:t,onTap:t,opacity:.3,perfectDrawEnabled:!1}):i().createElement(h.rw,{key:n,x:e.x,y:e.y,width:e.width,height:e.height,fill:"rgba(255,255,0,0.3)",stroke:"orange",strokeWidth:1,onClick:t,onTap:t,perfectDrawEnabled:!1})};return i().createElement("div",{ref:be,className:f.pageContainer,style:{position:"relative",width:"100%"}},i().createElement(h.BI,{width:ge.width,height:ge.height,ref:we,onMouseDown:De,onTouchStart:De,onMouseMove:Oe,onTouchMove:Oe,onMouseUp:Be,onTouchEnd:Be,className:f.stage,style:{display:"block",touchAction:"none"}},i().createElement(h.Wd,null,_e&&i().createElement(h._V,{image:_e,x:0,y:0,width:ge.width,height:ge.height}),N.map(function(e,n){if("group"===e.type)return e.highlights.map(function(e,t){var o="freehand"===e.type?Ee(e,ge.width,ge.height):Ce(e,ge.width,ge.height);return Te(o,"group-".concat(n,"-").concat(t),function(e){e.cancelBubble=!0,z&&Me(n,t,!1)})});var t="freehand"===e.type?Ee(e,ge.width,ge.height):Ce(e,ge.width,ge.height);return Te(t,"single-".concat(n),function(e){e.cancelBubble=!0,z&&Me(n,null,!1)})}),H.map(function(e,n){var t="freehand"===e.type?Ee(e,ge.width,ge.height):Ce(e,ge.width,ge.height),o=function(e){e.cancelBubble=!0,z?Me(n,null,!0):We(n,e,!0)};return"freehand"===e.type?i().createElement(h.N1,{key:"pending-".concat(n),points:t.points,stroke:t.color||p,strokeWidth:t.strokeWidth||v,tension:.5,lineCap:"round",lineJoin:"round",opacity:.3,onClick:o,onTap:o,perfectDrawEnabled:!1}):i().createElement(h.rw,{key:"pending-".concat(n),x:t.x,y:t.y,width:t.width,height:t.height,fill:"rgba(255,255,0,0.2)",stroke:"orange",strokeWidth:2,dash:[8,4],onClick:o,onTap:o,perfectDrawEnabled:!1})}),R&&!g&&i().createElement(h.rw,{x:R.x,y:R.y,width:R.width,height:R.height,fill:"rgba(255,255,0,0.3)",stroke:"orange",strokeWidth:1,dash:[4,4]}),U&&g&&i().createElement(h.N1,{points:U.points,stroke:U.color||p,strokeWidth:U.strokeWidth||v,tension:.5,lineCap:"round",lineJoin:"round",opacity:.3}))),N.map(function(e,n){var t,o;if(null===(t=e.comments)||void 0===t||!t.length)return null;var a="group"===e.type&&null!==(o=e.highlights)&&void 0!==o&&o.length?e.highlights[e.highlights.length-1]:e,r=ge.width,l=ge.height,u=0,s=0;if("freehand"===a.type){var d=Ee(a,r,l).points;u=d[d.length-2],s=d[d.length-1]}else{if("rect"!==a.type)return null;var c=Ce(a,r,l);u=c.x+c.width+5,s=c.y}return i().createElement(_.I1r,{key:"icon-".concat(n),onClick:function(e){return We(n,e,!1)},onMouseDown:function(e){e.stopPropagation(),e.preventDefault()},onPointerDown:function(e){e.stopPropagation(),e.preventDefault()},style:{position:"absolute",left:"".concat(u,"px"),top:"".concat(s,"px"),cursor:"pointer",zIndex:1e3,fontSize:"20px",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.3))"}})}),Pe.visible&&(null!=V&&N[V]||null!=ne&&H[ne])&&c.createPortal(i().createElement("div",{ref:xe,className:f.commentBubble,style:{position:"absolute",top:Pe.top,left:Pe.left,zIndex:2e3},onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){e.stopPropagation()},onPointerDown:function(e){e.stopPropagation()}},i().createElement("div",{className:f.commentArrow}),i().createElement("textarea",{rows:3,placeholder:null!=ne?"Add comment to group all highlights...":"Add comment...",value:se,onChange:function(e){var n=e.target.value;de(n),null==ne||""===n.trim()?null!=V&&M(function(e){var t=(0,r.A)(e);return t[V].comments||(t[V].comments=[{text:""}]),t[V].comments[0].text=n,t}):M(function(e){var t={type:"group",highlights:(0,r.A)(H),comments:[{text:n,createdAt:Date.now()}]},o=[].concat((0,r.A)(e),[t]);return j([]),te(null),q(o.length-1),o})},onBlur:Ne,autoFocus:!1,className:f.commentTextarea}),H.length>0&&i().createElement("div",{className:f.pendingInfo},H.length," highlight(s) pending grouping")),document.body))};var x=t(7166),y=(0,o.memo)(function(e){var n=e.pageImages,t=e.pdfId,o=e.isDrawing,a=e.isFreehand,r=e.highlightColor,l=e.brushSize,u=e.setIsDrawing,s=e.setIsCommentOpen,d=e.bookSize,c=e.freehandWithComment,h=e.serverAnnotations,g=e.onAnnotationsChange,p=e.isEraser,m=e.onDeleteAnnotation,f=e.onUpdateHighlightComment;return i().createElement(i().Fragment,null,n.map(function(e,n){var _=n+1;return i().createElement("div",{key:n,className:x.A.page},i().createElement(w,{pageImage:e,pageNumber:_,pdfId:t,isDrawing:o,isFreehand:a,highlightColor:r,brushSize:l,setIsDrawing:u,setIsCommentOpen:s,stageWidth:d.width,stageHeight:d.height,freehandOpensComment:c,serverAnnotations:h,onAnnotationsChange:g,eraserMode:p,onDeleteAnnotation:m,onUpdateHighlightComment:f}))}))});y.displayName="PageRenderer";const k=y}}]);